<!DOCTYPE html>
<html lang="en">
<head>
  <title>Alex Cycle Shop</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/style.css" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />

  <!-- Your CSS LAST -->
  <link rel="stylesheet" href="styles/style.css" />

<link rel="stylesheet" href="styles/style.css" />
<script src="main.js" defer></script>
</head>
<body>


  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container py-2">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#top">
        <span class="rounded-circle bg-dark text-white d-inline-flex align-items-center justify-content-center"
              style="width:2rem;height:2rem;">
          <i class="bi bi-bicycle"></i>
        </span>
        <span class="fw-semibold">Alex Cycle Shop</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto gap-lg-2">
          <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="#booking">Book</a></li>
          <li class="nav-item"><a class="nav-link" href="#summary">Summary</a></li>
          <li class="nav-item"><a class="nav-link" href="#experts">Experts</a></li>
          <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#admin">Admin</a></li>
          <li class="nav-item">
            <a class="btn btn-primary ms-lg-2" href="#booking">
              <i class="bi bi-calendar2-check me-1"></i>Book service
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header id="top" class="py-4">
    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-12 col-lg-7">
          <div class="p-4 p-lg-5 bg-white rounded-4 shadow-soft">
            <p class="text-uppercase small text-secondary mb-2">Repairs • Tune-ups • Safety Checks</p>
            <h1 class="display-6 fw-semibold mb-3">Book a bike service in under 2 minutes.</h1>
            <p class="text-secondary mb-4">
              Transparent prices. Clear steps. Skilled mechanics. Bring your bike in and leave safer.
            </p>

            <div class="d-flex flex-column flex-sm-row gap-2">
              <a class="btn btn-primary btn-lg" href="#booking">
                <i class="bi bi-wrench-adjustable-circle me-2"></i>Start booking
              </a>
              <a class="btn btn-outline-secondary btn-lg" href="#services">View services & prices</a>
            </div>

            <hr class="my-4" />

            <div class="row g-3">
              <div class="col-12 col-md-4">
                <div class="d-flex gap-2">
                  <i class="bi bi-geo-alt text-secondary"></i>
                  <div>
                    <div class="fw-semibold">Address</div>
                    <div class="text-secondary small">123 Main St, Ottawa, ON</div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="d-flex gap-2">
                  <i class="bi bi-clock text-secondary"></i>
                  <div>
                    <div class="fw-semibold">Hours</div>
                    <div class="text-secondary small">Mon–Sat 10:00–18:00</div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="d-flex gap-2">
                  <i class="bi bi-telephone text-secondary"></i>
                  <div>
                    <div class="fw-semibold">Contact</div>
                    <div class="text-secondary small">(613) 555-0123</div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="col-12 col-lg-5">
          <div class="bg-white rounded-4 shadow-soft overflow-hidden">
            <img class="w-100" src="assets/Untitled design.png" alt="Bike service photo" />
          </div>
        </div>
      </div>
    </div>
  </header>

<main class="pb-5">
  <div class="container">

    <!-- Row 1: booking flow (left) + sidebar cards (right) -->
    <div class="row g-4">

      <!-- LEFT -->
      <div class="col-12 col-lg-8">

        <!-- SERVICES -->
        <section id="services" class="mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h4 mb-0">Services & Prices</h2>
            <span class="badge text-bg-secondary"><i class="bi bi-eye me-1"></i>Prices upfront</span>
          </div>
          <p class="text-secondary">Select one service to start booking.</p>

          <input class="btn-check" type="radio" name="service" id="svc-basic" autocomplete="off" required>
          <input class="btn-check" type="radio" name="service" id="svc-full" autocomplete="off">
          <input class="btn-check" type="radio" name="service" id="svc-flat" autocomplete="off">
          <input class="btn-check" type="radio" name="service" id="svc-brakes" autocomplete="off">

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="card service-card shadow-soft h-100" for="svc-basic">
                <img class="card-img-top" src="assets/1.png" alt="Basic tune-up mapping image" />
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h3 class="h6 mb-1">Basic Tune-Up</h3>
                      <p class="text-secondary small mb-2">Gears + brakes adjustment, safety check.</p>
                    </div>
                    <span class="badge text-bg-primary">$79</span>
                  </div>
                  <div class="small text-secondary"><i class="bi bi-hourglass-split me-1"></i>~60 min</div>
                </div>
              </label>
            </div>

            <div class="col-12 col-md-6">
              <label class="card service-card shadow-soft h-100" for="svc-full">
                <img class="card-img-top" src="assets/2.png" alt="Full tune-up mapping image" />
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h3 class="h6 mb-1">Full Tune-Up</h3>
                      <p class="text-secondary small mb-2">Deep clean + drivetrain care + adjustments.</p>
                    </div>
                    <span class="badge text-bg-primary">$149</span>
                  </div>
                  <div class="small text-secondary"><i class="bi bi-hourglass-split me-1"></i>~120 min</div>
                </div>
              </label>
            </div>

            <div class="col-12 col-md-6">
              <label class="card service-card shadow-soft h-100" for="svc-flat">
                <img class="card-img-top" src="assets/3.png" alt="Flat repair mapping image" />
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h3 class="h6 mb-1">Flat Repair</h3>
                      <p class="text-secondary small mb-2">Tube/patch + tire inspection.</p>
                    </div>
                    <span class="badge text-bg-primary">$25+</span>
                  </div>
                  <div class="small text-secondary"><i class="bi bi-hourglass-split me-1"></i>~30 min</div>
                </div>
              </label>
            </div>

            <div class="col-12 col-md-6">
              <label class="card service-card shadow-soft h-100" for="svc-brakes">
                <img class="card-img-top" src="assets/4.png" alt="Brake service mapping image" />
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h3 class="h6 mb-1">Brake Service</h3>
                      <p class="text-secondary small mb-2">Adjust pads/cables, braking test.</p>
                    </div>
                    <span class="badge text-bg-primary">$35+</span>
                  </div>
                  <div class="small text-secondary"><i class="bi bi-hourglass-split me-1"></i>~30–45 min</div>
                </div>
              </label>
            </div>
          </div>

          <div class="mt-3 d-flex justify-content-end">
            <a id="btnNextService" class="btn btn-primary disabled" href="#booking" aria-disabled="true">
              Next: pick date & time <i class="bi bi-arrow-right ms-1"></i>
            </a>
          </div>
        </section>

        <!-- BOOKING -->
        <section id="booking">
          <h2 class="h4 mb-2">Book your appointment</h2>
          <p class="text-secondary mb-3">Mon–Sat only. Booking times are in 15-minute increments (10:00–18:00).</p>

          <!-- Step 2 -->
          <div class="card shadow-soft mb-3">
            <div class="card-body">
              <h3 class="h5 mb-3">2) Choose date & time</h3>

              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="date">
                    <i class="bi bi-calendar3 me-1"></i>Date (Mon–Sat)
                  </label>
                  <input class="form-control" id="date" type="date" required />
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="time">
                    <i class="bi bi-clock me-1"></i>Appointment start time
                  </label>
                  <select class="form-select" id="time" required>
                    <!-- options injected by JS (15-min steps) -->
                  </select>
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="pickup">
                    <i class="bi bi-box-arrow-up-right me-1"></i>Pickup time (optional)
                  </label>
                  <select class="form-select" id="pickup">
                    <!-- options injected by JS (blank + 15-min steps) -->
                  </select>
                  <div class="form-text">
                    Earliest pickup time (start + service duration): <span id="earliestPickup">—</span>.
                    Leave blank to auto-set to the earliest pickup.
                  </div>
                  <div id="pickupHint" class="small text-secondary mt-1"></div>
                </div>
              </div>

              <div class="mt-3 d-flex justify-content-end">
                <a id="btnNextSchedule" class="btn btn-primary disabled" href="#contact" aria-disabled="true">
                  Next: your details <i class="bi bi-arrow-right ms-1"></i>
                </a>
              </div>
            </div>
          </div>

          <!-- Step 3 -->
          <div id="contact" class="card shadow-soft">
            <div class="card-body">
              <h3 class="h5 mb-3">3) Your contact info</h3>

              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="name">
                    <i class="bi bi-person me-1"></i>Full name
                  </label>
                  <input class="form-control" id="name" type="text" placeholder="Alex Chen" required />
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label fw-semibold" for="phone">
                    <i class="bi bi-telephone me-1"></i>Phone
                  </label>
                  <input class="form-control" id="phone" type="tel" placeholder="(613) 555-0123" required />
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="email">
                    <i class="bi bi-envelope me-1"></i>Email
                  </label>
                  <input class="form-control" id="email" type="email" placeholder="alex@example.com" required />
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="notes">
                    <i class="bi bi-chat-left-text me-1"></i>Additional comments (optional)
                  </label>
                  <textarea class="form-control" id="notes" rows="3"
                            placeholder="Bike model, issue details, etc."></textarea>
                </div>
              </div>

              <div id="formAlert" class="alert alert-warning mt-3 d-none" role="alert"></div>

              <div class="mt-4">
                <button id="confirmBtn" class="btn btn-primary btn-lg w-100 shadow-soft" type="button" disabled>
                  <i class="bi bi-check2-circle me-2"></i>Confirm booking
                </button>
                <p class="small text-secondary mt-2 mb-0">
                  Prototype: stores bookings in your browser (localStorage). Admin view below shows reserved appointments.
                </p>
              </div>
            </div>
          </div>
        </section>

      </div>

      <!-- RIGHT -->
      <div class="col-12 col-lg-4" id="sidebarCol">
        <div id="sidebar" class="vstack gap-4">

          <!-- EXPERTS -->
          <div class="card shadow-soft">
            <!-- id on header so navbar jump lands on the title bar -->
            <div class="card-header bg-white" id="experts">
              <div class="fw-semibold"><i class="bi bi-people me-1"></i>Our experts</div>
              <div class="text-secondary small">Meet the mechanics who’ll work on your bike.</div>
            </div>

            <div class="card-body">
              <div class="d-flex gap-3 mb-3">
                <img class="rounded-circle" width="56" height="56"
                    src="https://placehold.co/112x112?text=A" alt="Mechanic avatar" />
                <div>
                  <div class="fw-semibold">Alex Nguyen</div>
                  <div class="text-secondary small">Lead Mechanic • Drivetrain & tune-ups</div>
                  <div class="small mt-1"><i class="bi bi-award me-1"></i>15+ years experience</div>
                </div>
              </div>

              <hr class="my-3" />

              <div class="d-flex gap-3">
                <img class="rounded-circle" width="56" height="56"
                    src="https://placehold.co/112x112?text=M" alt="Mechanic avatar" />
                <div>
                  <div class="fw-semibold">Maya Patel</div>
                  <div class="text-secondary small">Service Specialist • Brakes & wheels</div>
                  <div class="small mt-1"><i class="bi bi-lightning-charge me-1"></i>Fast diagnostics</div>
                </div>
              </div>
            </div>
          </div>

          <!-- ABOUT -->
          <div class="card shadow-soft">
            <!-- id on header so navbar jump lands on the title bar -->
            <div class="card-header bg-white" id="about">
              <div class="fw-semibold"><i class="bi bi-info-circle me-1"></i>About Alex Cycle Shop</div>
            </div>

            <div class="card-body">
              <p class="text-secondary small mb-3">
                Alex Cycle Shop started in 2016 as a tiny weekend repair booth near the Ottawa bike paths.
                What began as “fix-one-bike, teach-one-skill” grew into a full service counter as local riders
                asked for trustworthy diagnostics and upfront pricing.
              </p>

              <div class="fw-semibold small mb-2">Core working ethics</div>
              <ul class="list-unstyled small text-secondary mb-0">
                <li class="mb-2">
                  <i class="bi bi-tag me-2"></i><span class="fw-semibold text-dark">Transparent pricing:</span>
                  no surprise add-ons—changes are approved before work starts.
                </li>
                <li class="mb-2">
                  <i class="bi bi-shield-check me-2"></i><span class="fw-semibold text-dark">Safety first:</span>
                  brakes, wheels, and drivetrain checks are prioritized on every service.
                </li>
                <li class="mb-2">
                  <i class="bi bi-clock-history me-2"></i><span class="fw-semibold text-dark">Respect your time:</span>
                  appointments are scheduled to avoid overlaps and keep turnaround predictable.
                </li>
                <li class="mb-2">
                  <i class="bi bi-recycle me-2"></i><span class="fw-semibold text-dark">Sustainable repairs:</span>
                  repair before replace whenever it’s safe and cost-effective.
                </li>
                <li>
                  <i class="bi bi-people me-2"></i><span class="fw-semibold text-dark">Welcoming service:</span>
                  clear explanations for beginners and experienced riders alike.
                </li>
              </ul>
            </div>
          </div>

          <!-- SUMMARY (put id on header so navbar jump shows title) -->
          <div id="summaryCard" class="card shadow-soft border border-primary">
            <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between" id="summary">
              <div class="fw-semibold"><i class="bi bi-receipt me-1"></i>Your booking summary</div>
              <span class="badge text-bg-light text-primary">Current</span>
            </div>

            <div class="card-body">
              <div class="mb-2 fw-semibold">Service</div>
              <div class="text-secondary small mb-3" id="summaryServiceLine">
                <i class="bi bi-dash me-1"></i>Select a service above
              </div>

              <div class="mb-2 fw-semibold">Schedule</div>
              <div class="text-secondary small">
                <div id="summaryDateLine"><i class="bi bi-dash me-1"></i>Select a date</div>
                <div id="summaryTimeLine"><i class="bi bi-dash me-1"></i>Select a start time</div>
                <div id="summaryPickupLine"><i class="bi bi-dash me-1"></i>Pickup time (optional)</div>
              </div>

              <hr class="my-3" />
              <div class="small text-secondary">
                <i class="bi bi-shield-check me-1"></i>Transparent pricing • No add-ons without approval
              </div>
            </div>
          </div>

        </div>

        <!-- spacer keeps the column height stable when sidebar becomes fixed -->
        <div id="sidebarSpacer" aria-hidden="true"></div>
      </div>



      <!-- Row 2: ADMIN (full width, avoids empty sidebar) -->
      <section id="admin" class="mt-5">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h2 class="h4 mb-0">Admin: Reserved appointments</h2>
          <button id="clearAllBtn" type="button" class="btn btn-outline-danger btn-sm">
            <i class="bi bi-trash3 me-1"></i>Clear all
          </button>
        </div>
        <p class="text-secondary mb-3">
          Hours constraint: Mon–Sat 10:00–18:00. Only one customer can be served at a time (no overlapping intervals).
        </p>

        <div class="card shadow-soft">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead>
                  <tr>
                    <th>Service</th>
                    <th>Date</th>
                    <th>Start</th>
                    <th>Earliest pickup</th>
                    <th>Pickup</th>
                    <th>Name</th>
                    <th>Comments</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody id="adminBookingsBody">
                  <tr><td colspan="8" class="text-secondary">No appointments yet.</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

    <!-- Footer -->
    <footer class="mt-5 pt-4 border-top text-secondary small">
      <div class="row g-2">
        <div class="col-12 col-md">
          <div class="fw-semibold text-dark">Alex Cycle Shop</div>
          123 Main St, Ottawa, ON • Mon–Sat 10:00–18:00
        </div>
        <div class="col-12 col-md-auto">
          <i class="bi bi-telephone me-1"></i>(613) 555-0123
          <span class="mx-2">•</span>
          <i class="bi bi-envelope me-1"></i>alex@cycle.shop
        </div>
      </div>
    </footer>

  </div>
</main>


  <!-- MODAL -->
  <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title h5">
            <i class="bi bi-check2-circle text-success me-2"></i>Booking received
          </h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">We’ve recorded your request. Summary:</p>
          <ul class="mb-0">
            <li><span class="fw-semibold">Service:</span> <span id="modalService">—</span></li>
            <li><span class="fw-semibold">Date:</span> <span id="modalDate">—</span></li>
            <li><span class="fw-semibold">Start:</span> <span id="modalTime">—</span></li>
            <li><span class="fw-semibold">Pickup:</span> <span id="modalPickup">—</span></li>
            <li><span class="fw-semibold">Name:</span> <span id="modalName">—</span></li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      const SERVICE_MAP = {
        "svc-basic":  { name: "Basic Tune-Up", price: "$79",  durationLabel: "~60 min",  durationMinutes: 60  },
        "svc-full":   { name: "Full Tune-Up",  price: "$149", durationLabel: "~120 min", durationMinutes: 120 },
        "svc-flat":   { name: "Flat Repair",   price: "$25+", durationLabel: "~30 min",  durationMinutes: 30  },
        "svc-brakes": { name: "Brake Service", price: "$35+", durationLabel: "~30–45 min", durationMinutes: 45 }
      };

      const KEY = "acs_bookings_v3";

      // Hours constraint: Mon–Sat 10:00–18:00
      const OPEN_MIN = 10 * 60;          // 600
      const CLOSE_MIN = 18 * 60;         // 1080
      const OPEN_STR = "10:00";
      const CLOSE_STR = "18:00";
      const STEP_MIN = 15;               // 15-minute increments
      const STEP_SECONDS = STEP_MIN * 60; // for <input type="time" step="...">

      const $ = (id) => document.getElementById(id);

      const radios = Array.from(document.querySelectorAll('input[name="service"]'));
      const dateEl = $("date");
      const timeEl = $("time");
      const pickupEl = $("pickup");
      const earliestPickupEl = $("earliestPickup");
      const pickupHintEl = $("pickupHint");

      const nameEl = $("name");
      const phoneEl = $("phone");
      const emailEl = $("email");
      const notesEl = $("notes");

      const btnNextService = $("btnNextService");
      const btnNextSchedule = $("btnNextSchedule");
      const confirmBtn = $("confirmBtn");
      const formAlert = $("formAlert");

      const summaryServiceLine = $("summaryServiceLine");
      const summaryDateLine = $("summaryDateLine");
      const summaryTimeLine = $("summaryTimeLine");
      const summaryPickupLine = $("summaryPickupLine");

      const adminBody = $("adminBookingsBody");
      const clearAllBtn = $("clearAllBtn");

      const modalService = $("modalService");
      const modalDate = $("modalDate");
      const modalTime = $("modalTime");
      const modalPickup = $("modalPickup");
      const modalName = $("modalName");

      // Ensure the browser pickers also use 15-min step + hour bounds
      timeEl.step = String(STEP_SECONDS);
      pickupEl.step = String(STEP_SECONDS);
      timeEl.min = OPEN_STR;
      timeEl.max = CLOSE_STR;
      pickupEl.min = OPEN_STR;
      pickupEl.max = CLOSE_STR;

      function parseTimeToMinutes(t) {
        if (!t || !/^\d{2}:\d{2}$/.test(t)) return null;
        const [hh, mm] = t.split(":").map(Number);
        if (hh < 0 || hh > 23 || mm < 0 || mm > 59) return null;
        return hh * 60 + mm;
      }

      function minutesToTimeStr(min) {
        const hh = Math.floor(min / 60);
        const mm = min % 60;
        return String(hh).padStart(2, "0") + ":" + String(mm).padStart(2, "0");
      }

      function is15MinStep(t) {
        const m = parseTimeToMinutes(t);
        if (m === null) return false;
        return (m % STEP_MIN) === 0;
      }

      function isWithinHours(mins) {
        return mins !== null && mins >= OPEN_MIN && mins <= CLOSE_MIN;
      }

      function isBusinessDay() {
        // dateEl.value is YYYY-MM-DD. Use local midnight.
        if (!dateEl.value) return false;
        const d = new Date(dateEl.value + "T00:00:00");
        const day = d.getDay(); // 0=Sun ... 6=Sat
        return day >= 1 && day <= 6; // Mon–Sat
      }

      function getSelectedService() {
        const sel = radios.find(r => r.checked);
        if (!sel) return null;
        return { id: sel.id, ...SERVICE_MAP[sel.id] };
      }

      function isDateValid() {
        return dateEl.value && dateEl.checkValidity() && isBusinessDay();
      }

      function isTimeValid() {
        const m = parseTimeToMinutes(timeEl.value);
        return timeEl.checkValidity() && isWithinHours(m) && is15MinStep(timeEl.value);
      }

      function isPickupValidOrEmpty(earliestPickupMin) {
        if (!pickupEl.value) return true;
        const p = parseTimeToMinutes(pickupEl.value);
        return pickupEl.checkValidity()
          && isWithinHours(p)
          && is15MinStep(pickupEl.value)
          && (earliestPickupMin !== null)
          && (p >= earliestPickupMin)
          && (p <= CLOSE_MIN);
      }

      function isContactValid() {
        return nameEl.checkValidity() && phoneEl.checkValidity() && emailEl.checkValidity();
      }

      function setEnabledAnchor(a, enabled) {
        a.classList.toggle("disabled", !enabled);
        a.setAttribute("aria-disabled", enabled ? "false" : "true");
      }

      function showAlert(msg) {
        formAlert.textContent = msg;
        formAlert.classList.remove("d-none");
      }

      function clearAlert() {
        formAlert.classList.add("d-none");
        formAlert.textContent = "";
      }

      function computeEarliestPickupMinutes() {
        const svc = getSelectedService();
        const startMin = parseTimeToMinutes(timeEl.value);
        if (!svc || startMin === null) return null;
        const endMin = startMin + svc.durationMinutes;

        // Enforce business hours: service must finish by 18:00
        if (startMin < OPEN_MIN) return null;
        if (endMin > CLOSE_MIN) return null;

        return endMin;
      }

      function overlaps(aStart, aEnd, bStart, bEnd) {
        return aStart < bEnd && bStart < aEnd;
      }

      function updateEarliestPickupUI() {
        const earliest = computeEarliestPickupMinutes();
        if (earliest === null) {
          earliestPickupEl.textContent = "—";
          buildTimeOptions(pickupEl, OPEN_MIN, CLOSE_MIN, STEP_MIN, true, "Auto (earliest pickup)");
          pickupHintEl.textContent = "";
          return;
        }

        const earliestStr = minutesToTimeStr(earliest);
        earliestPickupEl.textContent = earliestStr;

        // pickup options: blank (auto) + 15-min times from earliest -> close
        buildTimeOptions(pickupEl, earliest, CLOSE_MIN, STEP_MIN, true, `Auto (${earliestStr})`);
        pickupHintEl.textContent = "Pickup must be at/after earliest pickup and within 10:00–18:00 (15-min steps).";
      }

      function updateSummary() {
        const svc = getSelectedService();
        if (svc) {
          summaryServiceLine.innerHTML =
            `<i class="bi bi-check2 me-1"></i>${svc.name} — ${svc.price} <span class="text-secondary">(${svc.durationLabel})</span>`;
        } else {
          summaryServiceLine.innerHTML = `<i class="bi bi-dash me-1"></i>Select a service above`;
        }

        summaryDateLine.innerHTML = isDateValid()
          ? `<i class="bi bi-calendar3 me-1"></i>${dateEl.value}`
          : `<i class="bi bi-dash me-1"></i>Select a date (Mon–Sat)`;

        summaryTimeLine.innerHTML = isTimeValid()
          ? `<i class="bi bi-clock me-1"></i>${timeEl.value}`
          : `<i class="bi bi-dash me-1"></i>Select a start time (10:00–18:00)`;

        const earliest = computeEarliestPickupMinutes();
        if (pickupEl.value) {
          summaryPickupLine.innerHTML = `<i class="bi bi-box-arrow-up-right me-1"></i>${pickupEl.value}`;
        } else if (earliest !== null) {
          summaryPickupLine.innerHTML =
            `<i class="bi bi-box-arrow-up-right me-1"></i>(auto) ${minutesToTimeStr(earliest)}`;
        } else {
          summaryPickupLine.innerHTML = `<i class="bi bi-dash me-1"></i>Pickup time (optional)`;
        }
      }

      function updateControls() {
        clearAlert();

        const hasSvc = !!getSelectedService();
        setEnabledAnchor(btnNextService, hasSvc);

        const hasSchedule = isDateValid() && isTimeValid();
        setEnabledAnchor(btnNextSchedule, hasSchedule);

        updateEarliestPickupUI();
        const earliest = computeEarliestPickupMinutes();
        const pickupOK = isPickupValidOrEmpty(earliest);

        const readyToConfirm = hasSvc && hasSchedule && pickupOK && isContactValid();
        confirmBtn.disabled = !readyToConfirm;

        updateSummary();
      }

      function loadBookings() {
        try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
        catch { return []; }
      }

      function saveBookings(bookings) {
        localStorage.setItem(KEY, JSON.stringify(bookings));
      }

      function renderBookings() {
        const bookings = loadBookings();
        adminBody.innerHTML = "";

        if (bookings.length === 0) {
          adminBody.innerHTML = `<tr><td colspan="8" class="text-secondary">No appointments yet.</td></tr>`;
          return;
        }

        for (const b of bookings) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>
              <div class="fw-semibold">${b.serviceName}</div>
              <div class="text-secondary small">${b.servicePrice} • ${b.durationLabel}</div>
            </td>
            <td>${b.date}</td>
            <td>${b.startTime}</td>
            <td>${b.earliestPickupTime}</td>
            <td>${b.pickupTime}</td>
            <td>
              <div class="fw-semibold">${b.name}</div>
              <div class="text-secondary small">${b.phone} • ${b.email}</div>
            </td>
            <td class="text-secondary small">${b.notes ? b.notes : "—"}</td>
            <td class="text-end">
              <button type="button" class="btn btn-outline-danger btn-sm" data-del="${b.id}">
                <i class="bi bi-x-circle me-1"></i>Delete
              </button>
            </td>
          `;
          adminBody.appendChild(tr);
        }
      }

      function wouldConflict(newDate, newStartMin, newEndMin) {
        const bookings = loadBookings();
        for (const b of bookings) {
          if (b.date !== newDate) continue;
          const bStart = parseTimeToMinutes(b.startTime);
          const bEnd = parseTimeToMinutes(b.endTime);
          if (bStart === null || bEnd === null) continue;
          if (overlaps(newStartMin, newEndMin, bStart, bEnd)) return b;
        }
        return null;
      }

      function createBookingOrError() {
        const svc = getSelectedService();
        if (!svc) return { error: "Please select a service." };

        if (!isDateValid()) return { error: "Please select a valid date (Mon–Sat only)." };

        if (!isTimeValid()) {
          return { error: "Start time must be within 10:00–18:00 and on a 15-minute step." };
        }

        const startMin = parseTimeToMinutes(timeEl.value);
        const endMin = startMin + svc.durationMinutes;

        // Must finish by closing time (18:00)
        if (endMin > CLOSE_MIN) {
          return { error: "This service would end after 18:00. Please choose an earlier start time." };
        }

        const earliestPickupMin = endMin;
        const earliestPickupStr = minutesToTimeStr(earliestPickupMin);

        let pickupStr = pickupEl.value;
        if (!pickupStr) {
          pickupStr = earliestPickupStr; // default: start + duration
        } else {
          if (!is15MinStep(pickupStr)) return { error: "Pickup time must be in 15-minute steps." };
          const pickupMin = parseTimeToMinutes(pickupStr);
          if (!isWithinHours(pickupMin)) return { error: "Pickup time must be within 10:00–18:00." };
          if (pickupMin < earliestPickupMin) {
            return { error: `Pickup must be at/after earliest pickup (${earliestPickupStr}).` };
          }
        }

        if (!isContactValid()) return { error: "Please complete your contact info (name/phone/email)." };

        // Only one customer at a time (no overlapping service interval)
        const conflict = wouldConflict(dateEl.value, startMin, endMin);
        if (conflict) {
          return {
            error: `Time conflict: another appointment overlaps (${conflict.startTime}–${conflict.endTime}). Please choose a different time.`
          };
        }

        return {
          booking: {
            id: String(Date.now()),
            serviceId: svc.id,
            serviceName: svc.name,
            servicePrice: svc.price,
            durationMinutes: svc.durationMinutes,
            durationLabel: svc.durationLabel,
            date: dateEl.value,
            startTime: timeEl.value,
            endTime: minutesToTimeStr(endMin),
            earliestPickupTime: earliestPickupStr,
            pickupTime: pickupStr,
            name: nameEl.value.trim(),
            phone: phoneEl.value.trim(),
            email: emailEl.value.trim(),
            notes: (notesEl.value || "").trim(),
            createdAt: new Date().toISOString()
          }
        };
      }

      function buildTimeOptions(selectEl, startMin, endMin, stepMin, includeBlank, blankLabel) {
        selectEl.innerHTML = "";
        if (includeBlank) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = blankLabel || "Auto (earliest pickup)";
          selectEl.appendChild(opt);
        }
        for (let m = startMin; m <= endMin; m += stepMin) {
          const t = minutesToTimeStr(m);
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = t;
          selectEl.appendChild(opt);
        }
      }

      function rebuildStartTimes() {
        const svc = getSelectedService();
        const maxStart = svc ? (CLOSE_MIN - svc.durationMinutes) : CLOSE_MIN;
        buildTimeOptions(timeEl, OPEN_MIN, maxStart, STEP_MIN, false);
      }


      // events
      radios.forEach(r => r.addEventListener("change", function () {
        rebuildStartTimes();
        updateControls();
      }));

      [dateEl, timeEl, pickupEl, nameEl, phoneEl, emailEl, notesEl].forEach(el => {
        el.addEventListener(el.tagName === "SELECT" ? "change" : "input", updateControls);
      });



      confirmBtn.addEventListener("click", function () {
        clearAlert();
        updateControls();

        const res = createBookingOrError();
        if (res.error) { showAlert(res.error); return; }

        const bookings = loadBookings();
        bookings.unshift(res.booking);
        saveBookings(bookings);
        renderBookings();

        // modal
        modalService.textContent = `${res.booking.serviceName} (${res.booking.servicePrice})`;
        modalDate.textContent = res.booking.date;
        modalTime.textContent = res.booking.startTime;
        modalPickup.textContent = res.booking.pickupTime;
        modalName.textContent = res.booking.name;

        new bootstrap.Modal(document.getElementById("confirmModal")).show();
      });

      adminBody.addEventListener("click", function (e) {
        const btn = e.target.closest("[data-del]");
        if (!btn) return;
        const id = btn.getAttribute("data-del");
        const bookings = loadBookings().filter(b => b.id !== id);
        saveBookings(bookings);
        renderBookings();
      });

      clearAllBtn.addEventListener("click", function () {
        saveBookings([]);
        renderBookings();
      });

      // init
      renderBookings();
      rebuildStartTimes();
      updateEarliestPickupUI();
      updateControls()
    })();
  </script>
</body>
</html>
